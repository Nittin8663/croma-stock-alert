from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.common.by import By
import time

def check_stock_with_selenium(url, product_name):
    # Set up Chrome options
    chrome_options = Options()
    chrome_options.add_argument("--headless")  # Run in headless mode
    chrome_options.add_argument("--no-sandbox")
    chrome_options.add_argument("--disable-dev-shm-usage")
    
    # Initialize the driver
    service = Service(ChromeDriverManager().install())
    driver = webdriver.Chrome(service=service, options=chrome_options)
    
    try:
        # Navigate to the URL
        print(f"Checking {product_name}...")
        driver.get(url)
        time.sleep(5)  # Allow time for the page to load
        
        # Check for out of stock indicators
        page_text = driver.page_source.lower()
        if any(indicator in page_text for indicator in ['out of stock', 'sold out', 'currently unavailable']):
            print(f"❌ {product_name} is OUT OF STOCK")
            return False
        
        # Check for add to cart button
        add_to_cart_buttons = driver.find_elements(By.CSS_SELECTOR, 'button[data-testid="add-to-cart"], .pdp-button')
        if add_to_cart_buttons and not 'disabled' in add_to_cart_buttons[0].get_attribute('class'):
            print(f"✅ {product_name} is IN STOCK!")
            return True
        
        print(f"❓ Could not determine stock status for {product_name}")
        return False
    
    finally:
        driver.quit()

# Products to check
products = [
    {"name": "Vivo X200 FE 5G", "url": "https://www.croma.com/vivo-x200-fe-5g-12gb-ram-256gb-frost-blue-/p/316890"},
    {"name": "Vivo Y300 5G", "url": "https://www.croma.com/vivo-y300-5g-8gb-ram-128gb-rom-emerald-green-/p/311901"}
]

# Check all products
for product in products:
    check_stock_with_selenium(product["url"], product["name"])
